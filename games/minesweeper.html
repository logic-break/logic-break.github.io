// –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –≤ –∫–æ–¥ —Å–∞–ø–µ—Ä–∞ (–≤ —Ä–∞–∑–¥–µ–ª —Å –¥—Ä—É–≥–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏)
function checkAllFlags() {
    const totalCells = rows * cols;
    let flaggedCells = 0;
    let correctFlags = 0;
    
    // –°—á–∏—Ç–∞–µ–º —Ñ–ª–∞–≥–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏
    for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
            const cell = board[i][j];
            if (cell.isFlagged) {
                flaggedCells++;
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—Ç–æ–∏—Ç –ª–∏ —Ñ–ª–∞–≥ –Ω–∞ –º–∏–Ω–µ
                if (cell.isMine) {
                    correctFlags++;
                }
            }
        }
    }
    
    // –ï—Å–ª–∏ –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –≤ —Ñ–ª–∞–≥–∞—Ö –ò –≤—Å–µ —Ñ–ª–∞–≥–∏ —Å—Ç–æ—è—Ç –Ω–∞ –º–∏–Ω–∞—Ö
    if (flaggedCells === totalCells && correctFlags === totalMines) {
        playRedFlagSound();
        return true;
    }
    
    // –ò–ª–∏ –µ—Å–ª–∏ –≤—Å–µ –º–∏–Ω—ã –ø–æ–º–µ—á–µ–Ω—ã —Ñ–ª–∞–≥–∞–º–∏ (–¥–∞–∂–µ –µ—Å–ª–∏ –µ—Å—Ç—å –ª–∏—à–Ω–∏–µ —Ñ–ª–∞–≥–∏)
    if (correctFlags === totalMines && flaggedCells >= totalMines) {
        playRedFlagSound();
        return true;
    }
    
    return false;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞
function playRedFlagSound() {
    const audio = new Audio('redflag.mp3');
    audio.volume = 1.0;
    
    const playPromise = audio.play();
    if (playPromise !== undefined) {
        playPromise.catch(error => {
            console.log("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ");
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –∑–≤—É–∫ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è
            gameStatus.textContent = "üéµ RED FLAG! üéµ (–ó–≤—É–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)";
            gameStatus.style.color = '#ff5252';
            setTimeout(() => {
                if (gameActive) gameStatus.textContent = '';
            }, 3000);
        });
    }
}

// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é toggleFlag —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ —Ñ–ª–∞–≥–∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏/—Å–Ω—è—Ç–∏—è —Ñ–ª–∞–≥–∞
function toggleFlag(row, col) {
    if (!gameActive || board[row][col].isRevealed) {
        return;
    }
    
    const cell = board[row][col];
    
    if (cell.isFlagged) {
        cell.isFlagged = false;
        cell.element.classList.remove('flagged');
        flaggedCells--;
    } else {
        cell.isFlagged = true;
        cell.element.classList.add('flagged');
        flaggedCells++;
    }
    
    updateMinesCounter();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –ø–æ–ª–µ –≤ —Ñ–ª–∞–≥–∞—Ö
    checkAllFlags();
}

// –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –≤ —Ñ—É–Ω–∫—Ü–∏—é revealCell (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–ª–µ—Ç–∫—É –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–ª–∞–≥–æ–≤)
function revealCell(row, col) {
    if (!gameActive || board[row][col].isRevealed || board[row][col].isFlagged) {
        return;
    }
    
    // –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ —Ä–∞–∑–º–µ—â–∞–µ–º –º–∏–Ω—ã
    if (firstClick) {
        placeMines(row, col);
        firstClick = false;
    }
    
    const cell = board[row][col];
    
    // –ï—Å–ª–∏ –Ω–∞–∂–∞–ª–∏ –Ω–∞ –º–∏–Ω—É
    if (cell.isMine) {
        cell.isRevealed = true;
        cell.element.classList.add('revealed', 'mine');
        loseLife();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥–∏ –ø–æ—Å–ª–µ –ø–æ—Ç–µ—Ä–∏ –∂–∏–∑–Ω–∏ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
        setTimeout(() => checkAllFlags(), 100);
        return;
    }
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —è—á–µ–π–∫—É
    cell.isRevealed = true;
    cell.element.classList.add('revealed');
    revealedCells++;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω –≤–æ–∫—Ä—É–≥
    if (cell.adjacentMines > 0) {
        cell.element.textContent = cell.adjacentMines;
        cell.element.classList.add(`number-${cell.adjacentMines}`);
    } else {
        // –ï—Å–ª–∏ –º–∏–Ω –≤–æ–∫—Ä—É–≥ –Ω–µ—Ç, –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å–æ—Å–µ–¥–Ω–∏–µ —è—á–µ–π–∫–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
        for (let i = -1; i <= 1; i++) {
            for (let j = -1; j <= 1; j++) {
                const newRow = row + i;
                const newCol = col + j;
                
                if (newRow >= 0 && newRow < rows && newCol >= 0 && newCol < cols) {
                    if (!board[newRow][newCol].isRevealed && !board[newRow][newCol].isFlagged) {
                        revealCell(newRow, newCol);
                    }
                }
            }
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–∏–≥—Ä–∞–ª –ª–∏ –∏–≥—Ä–æ–∫
    checkWinCondition();
    
    // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥–∏ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–ª–µ—Ç–∫–∏
    setTimeout(() => checkAllFlags(), 100);
}
